<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage Test</title>
    <style>
        @font-face {
            font-family: 'DotGothic16';
            src: url('fonts/DotGothic16-Regular.ttf') format('truetype');
        }

        body {
            margin: 0;
            font-family: 'DotGothic16', sans-serif;
            background: #22325c;
        }

        #stage-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            padding: 20px 0;
        }

        .stage-btn {
            width: 40vw;
            max-width: 250px;
            aspect-ratio: 1/2;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(12px, 2vw, 18px);
            transition: transform .2s;
            user-select: none;
        }

        .stage-btn:hover {
            transform: scale(1.1);
        }

        .stage-btn.locked,
        .stage-btn.cleared {
            pointer-events: none;
            cursor: default;
        }

        .stage-btn img.button-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .stage-btn.cleared img {
            pointer-events: none;
            /* クリア済みボタンも押せなくする */
        }

        .label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #22325c;
            font-weight: bold;
            font-size: clamp(12px, 2vw, 18px);
            pointer-events: none;
            text-align: center;
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <div id="stage-container"></div>

    <script>
        const totalStages = 21; // チュートリアル + 20ステージ
        const container = document.getElementById("stage-container");

        const stageStates = Array(totalStages).fill("locked");
        stageStates[0] = "unlocked"; // チュートリアル解放

        const startY = 5, offsetY = 25;

        for (let i = 0; i < totalStages; i++) {
            const btn = document.createElement("div");
            btn.className = "stage-btn";
            btn.dataset.index = i;
            if (stageStates[i] === "locked") btn.classList.add("locked");

            btn.style.left = "50%";
            btn.style.transform = "translateX(-50%)";
            btn.style.top = startY + offsetY * i + "%";

            // ボタン画像
            const img = document.createElement("img");
            img.className = "button-img";
            img.src = "pictures/stage-btn.png";
            btn.appendChild(img);

            // ラベル
            const label = document.createElement("span");
            label.className = "label";
            label.textContent = i === 0 ? "チュートリアル" : "ステージ" + i;
            btn.appendChild(label);

            container.appendChild(btn);

            const updateBtn = () => {
                if (stageStates[i] === "cleared") {
                    btn.classList.add("cleared");
                    btn.classList.remove("locked");
                } else if (stageStates[i] === "unlocked") {
                    btn.classList.remove("locked");
                    btn.classList.remove("cleared");
                } else {
                    btn.classList.add("locked");
                    btn.classList.remove("cleared");
                }
            };
            updateBtn();

            const clickHandler = () => {
                if (stageStates[i] !== "unlocked") return;

                stageStates[i] = "cleared";
                btn.classList.add("cleared");
                btn.classList.remove("locked");
                btn.removeEventListener("click", clickHandler);
                updateBtn();

                alert("ステージ " + (i === 0 ? "チュートリアル" : i) + " 開始！");

                const nextIndex = i + 1;
                if (nextIndex < totalStages && stageStates[nextIndex] === "locked") {
                    stageStates[nextIndex] = "unlocked";
                    const nextBtn = container.children[nextIndex];
                    nextBtn.classList.remove("locked");
                    nextBtn.classList.remove("cleared");
                    nextBtn.scrollIntoView({ behavior: "smooth", block: "center" });
                }
            };

            btn.addEventListener("click", clickHandler);
        }
    </script>
</body>

</html>